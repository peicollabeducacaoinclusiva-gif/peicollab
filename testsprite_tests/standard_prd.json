{
  "meta": {
    "project": "PEI Collab V2.1",
    "date": "2025-10-20",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "PEI Collab V2.1 is a collaborative platform designed for the management of Individualized Educational Plans (PEIs) with a focus on educational inclusion and integration among education networks, schools, teachers, families, and specialists. It features a hierarchical multi-tenant architecture supporting role-based access and offline-first progressive web app capabilities.",
  "core_goals": [
    "Enable comprehensive management and version control of Individualized Educational Plans (PEIs) for students across multiple education networks and schools.",
    "Provide role-based dashboards and functionalities to support workflows of diverse users including superadmins, coordinators, teachers, families, specialists, and school administrators.",
    "Support offline-first usage with automatic synchronization to ensure continuous availability and seamless experience in low or no internet connectivity scenarios.",
    "Deliver secure, controlled access to PEI data including family tokens for safe PEI viewing and approval by family members.",
    "Implement mobile-first responsive design and PWA features to optimize user experience across devices and platforms."
  ],
  "key_features": [
    "Robust authentication system supporting multiple user roles such as superadmin, education secretary, school director, coordinator, teacher, family, specialist, and more.",
    "Role-based dashboards tailored with specific functionalities for each user type to streamline interactions and data accessibility.",
    "Comprehensive PEI management including creation, editing, version control with automatic version incrementing, status tracking, and history viewing.",
    "Hierarchical multi-tenant architecture managing networks, schools, users, and associated data with strict Row Level Security (RLS).",
    "Offline-first functionality using IndexedDB with Dexie.js for local caching and automatic synchronization when back online.",
    "Progressive Web App (PWA) support enabling installation, offline use, push notifications, and service worker management.",
    "Family access system with secure time-limited tokens allowing family members to view and approve their children's PEIs.",
    "Integrated audit and logging system for tracking changes and maintaining compliance.",
    "Mobile-first design ensuring responsive layouts and mobile-friendly navigation and forms.",
    "Support for PEI meetings and specialist orientations including scheduling and participant management.",
    "CSV import/export functionality for student and user data management.",
    "A tutorial and onboarding system supporting user adoption and training."
  ],
  "user_flow_summary": [
    "Users authenticate via Supabase Auth and land on personalized dashboards based on their roles.",
    "Superadmins and network admins manage multi-tenant entities including education networks, schools, users, and roles.",
    "Teachers, AEE teachers, specialists, and coordinators create and manage PEIs with version control; they can add barriers, goals, orientations, referrals, and track progress.",
    "Family members use secure tokens to access and approve PEIs of their associated students.",
    "Offline users interact with the app seamlessly with local data caching and automatic synchronization upon reconnection.",
    "Users receive notifications and alerts via the PWA system and can install the app onto their devices for enhanced access.",
    "Audit logs and change histories are accessible by authorized roles to review PEI evolutions and user actions.",
    "PEI meetings and orientations are scheduled and managed through dedicated interfaces with participant tracking."
  ],
  "validation_criteria": [
    "All user roles enforce strict Row Level Security, verified through policy and function unit tests.",
    "PEI versioning triggers correctly create new versions and mark old versions as obsolete with unique active version per student.",
    "Offline-first data caching and synchronization work correctly, maintaining data consistency between IndexedDB and the backend.",
    "Family access tokens are securely generated, expire after 7 days, and their usage updates access logs accordingly.",
    "PWA features including service worker registration, offline fallback, update prompts, and installation flow are fully functional and meet Lighthouse performance standards (above 90%).",
    "Mobile-first responsive UI adapts correctly on different device sizes validated by automated viewport testing.",
    "Audit logs capture user actions, PEI changes, and access attempts accurately and are viewable by authorized roles.",
    "CSV import/export features process data correctly without data loss or corruption.",
    "User onboarding tutorials load and display properly for users on first access.",
    "Synced data shows correct 'is_synced' status flags and updates after successful synchronization events."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React",
      "Vite",
      "Tailwind CSS",
      "Supabase",
      "PostgreSQL",
      "PWA",
      "IndexedDB",
      "React Router",
      "React Hook Form",
      "Zod",
      "Radix UI",
      "Lucide React",
      "TanStack Query",
      "Dexie.js"
    ],
    "features": [
      {
        "name": "Authentication System",
        "description": "Sistema de autenticação com múltiplos roles (superadmin, coordinator, teacher, family, school_manager, aee_teacher, specialist, education_secretary, school_director)",
        "files": [
          "src/pages/Auth.tsx",
          "src/pages/Dashboard.tsx",
          "src/hooks/usePermissions.ts",
          "src/hooks/useTenant.ts",
          "src/lib/supabaseClient.ts",
          "src/integrations/supabase/client.ts"
        ]
      },
      {
        "name": "Role-based Dashboards",
        "description": "Dashboards específicos para cada tipo de usuário com funcionalidades personalizadas",
        "files": [
          "src/components/dashboards/SuperadminDashboard.tsx",
          "src/components/dashboards/CoordinatorDashboard.tsx",
          "src/components/dashboards/TeacherDashboard.tsx",
          "src/components/dashboards/FamilyDashboard.tsx",
          "src/components/dashboards/SchoolManagerDashboard.tsx",
          "src/components/dashboards/AEETeacherDashboard.tsx",
          "src/components/dashboards/SpecialistDashboard.tsx",
          "src/components/dashboards/EducationSecretaryDashboard.tsx",
          "src/components/dashboards/SchoolDirectorDashboard.tsx"
        ]
      },
      {
        "name": "PEI Management",
        "description": "Sistema completo de criação, edição e acompanhamento de Planos Educacionais Individualizados",
        "files": [
          "src/pages/CreatePEI.tsx",
          "src/components/pei/DiagnosisSection.tsx",
          "src/components/pei/PlanningSection.tsx",
          "src/components/pei/StudentIdentificationSection.tsx",
          "src/components/pei/ReferralsSection.tsx",
          "src/components/pei/PEITemplateSelector.tsx",
          "src/components/pei/PEIVersionCompare.tsx",
          "src/components/pei/PEIVersionHistory.tsx",
          "src/components/pei/ProgressIndicator.tsx",
          "src/components/pei/ReportView.tsx",
          "src/hooks/usePEIVersioning.ts"
        ]
      },
      {
        "name": "Student Management",
        "description": "Gestão completa de alunos com cadastro, edição e visualização de dados",
        "files": [
          "src/components/superadmin/CreateStudentDialog.tsx",
          "src/components/superadmin/EditStudentDialog.tsx",
          "src/components/superadmin/StudentsTable.tsx",
          "src/components/superadmin/StudentsTableWithCache.tsx",
          "src/components/forms/OfflineStudentForm.tsx"
        ]
      },
      {
        "name": "Multi-tenant Architecture",
        "description": "Arquitetura multi-tenant hierárquica (rede → escolas → usuários)",
        "files": [
          "src/components/superadmin/CreateTenantDialog.tsx",
          "src/components/superadmin/EditTenantDialog.tsx",
          "src/components/superadmin/TenantsTable.tsx",
          "src/hooks/useTenant.ts"
        ]
      },
      {
        "name": "User Management",
        "description": "Sistema de gestão de usuários com criação, edição e atribuição de roles",
        "files": [
          "src/components/superadmin/CreateUserDialog.tsx",
          "src/components/superadmin/EditUserDialog.tsx",
          "src/components/superadmin/UsersTable.tsx",
          "src/components/superadmin/SuperadminUserManagement.tsx"
        ]
      },
      {
        "name": "Family Access System",
        "description": "Sistema de acesso seguro para famílias visualizarem PEIs dos filhos",
        "files": [
          "src/pages/FamilyAccess.tsx",
          "src/pages/FamilyPEIView.tsx",
          "src/pages/SecureFamilyAccess.tsx",
          "src/components/family/FamilyPEIAccess.tsx",
          "src/components/coordinator/GenerateFamilyTokenDialog.tsx",
          "src/components/coordinator/FamilyTokenManager.tsx"
        ]
      },
      {
        "name": "Offline-First Architecture",
        "description": "Funcionalidade offline com sincronização automática quando online",
        "files": [
          "src/lib/offlineStorage.ts",
          "src/lib/offlineDatabase.ts",
          "src/hooks/useOfflineQuery.ts",
          "src/hooks/useOfflineSync.ts",
          "src/hooks/useOnlineStatus.ts",
          "src/hooks/useSyncOnReconnect.ts",
          "src/components/shared/OfflineIndicator.tsx",
          "src/components/shared/PendingChangesIndicator.tsx",
          "src/services/SyncService.ts",
          "src/services/cacheService.ts",
          "src/services/pendingChangesService.ts"
        ]
      },
      {
        "name": "PWA Features",
        "description": "Progressive Web App com service worker, cache e notificações push",
        "files": [
          "src/components/shared/PWAUpdatePrompt.tsx",
          "src/lib/notifications.ts",
          "src/components/shared/NotificationManager.tsx",
          "src/components/shared/NotificationBell.tsx",
          "vite.config.ts"
        ]
      },
      {
        "name": "Gamified Student Interface",
        "description": "Interface gamificada para estudantes com sistema de conquistas e atividades",
        "files": [
          "src/components/student/StudentGamifiedDashboard.tsx",
          "src/components/student/AchievementSystem.tsx",
          "src/components/student/GamifiedActivity.tsx"
        ]
      },
      {
        "name": "Mobile-First Design",
        "description": "Design responsivo e mobile-first com navegação otimizada para dispositivos móveis",
        "files": [
          "src/components/shared/MobileNavigation.tsx",
          "src/components/shared/ResponsiveLayout.tsx",
          "src/components/forms/MobilePEIForm.tsx",
          "src/hooks/use-mobile.tsx"
        ]
      },
      {
        "name": "Performance Optimization",
        "description": "Otimizações de performance para dispositivos móveis e conexões lentas",
        "files": [
          "src/lib/performanceOptimizer.ts",
          "src/lib/databaseTests.ts"
        ]
      },
      {
        "name": "Audit and Logging",
        "description": "Sistema de auditoria e logs para rastreamento de mudanças",
        "files": [
          "src/components/shared/AuditLogsViewer.tsx",
          "src/components/shared/SimpleAuditLogsViewer.tsx"
        ]
      },
      {
        "name": "CSV Import/Export",
        "description": "Funcionalidade de importação e exportação de dados via CSV",
        "files": [
          "src/components/superadmin/CSVUploadDialog.tsx",
          "src/components/superadmin/ImportCSVDialog.tsx"
        ]
      },
      {
        "name": "Testing and Debug Tools",
        "description": "Ferramentas de teste e debug para desenvolvimento e monitoramento",
        "files": [
          "src/components/debug/DatabaseTestRunner.tsx",
          "src/components/debug/UsabilityTestingManager.tsx",
          "src/components/debug/ImportTest.tsx",
          "src/components/dashboards/DebugUser.tsx",
          "src/lib/usabilityTesting.ts"
        ]
      },
      {
        "name": "Theme and UI Components",
        "description": "Sistema de temas e componentes UI reutilizáveis baseados em Radix UI",
        "files": [
          "src/components/shared/ThemeToggle.tsx",
          "src/components/ui/",
          "src/components/shared/InstitutionalLogo.tsx"
        ]
      },
      {
        "name": "PEI Meetings and Orientations",
        "description": "Sistema de reuniões e orientações relacionadas aos PEIs",
        "files": [
          "src/pages/PEIMeetings.tsx",
          "src/pages/PEIOrientations.tsx"
        ]
      },
      {
        "name": "Tutorial System",
        "description": "Sistema de tutoriais e onboarding para novos usuários",
        "files": [
          "src/components/tutorial/TutorialCards.tsx"
        ]
      }
    ]
  }
}
