{
  "meta": {
    "project": "PEI Collab V2.1",
    "date": "2025-10-29",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "PEI Collab is a collaborative platform designed to manage Individualized Educational Plans (PEIs) with a focus on educational inclusion and integration across educational networks, schools, teachers, families, and specialists. It supports mobile-first responsive design, offline-first capabilities via local caching, and is installable as a Progressive Web App (PWA).",
  "core_goals": [
    "Facilitate the creation, editing, versioning, and approval workflow of Individualized Educational Plans with hierarchical user role-based access.",
    "Enable real-time collaboration between teachers, coordinators, specialists, and families with secure access controls and family token-based viewing.",
    "Support multi-tenant architecture for educational networks and schools with fine-grained Role Level Security (RLS).",
    "Provide full offline functionality with synchronization of cached data and automatic conflict resolution to maintain usability without internet connectivity.",
    "Offer comprehensive dashboards and reporting tools for teachers, coordinators, and administrators to analyze PEI statuses, student data, and access patterns.",
    "Deliver a Mobile-First and PWA experience for easy access on any device including installable offline usage."
  ],
  "key_features": [
    "Authentication system with multi-profile and multi-role support including superadmin, network admins, coordinators, teachers (regular and specialized), specialists, and family members.",
    "Full CRUD student management linked to schools and tenants with family linkage and role-based access.",
    "Plan creation and editing module for PEIs with detailed sections such as diagnosis, planning, referrals, and accessibility resources.",
    "Automatic PEI versioning with active version indicators, version history, and comparison views to manage revisions and ensure data integrity.",
    "Teacher and coordinator dashboards providing statistics, PEI queues, approvals, and student overview with real-time updates.",
    "Family access through secure expiring tokens allowing limited and auditable PEI viewing.",
    "Offline-first data caching using IndexedDB (Dexie.js) with synchronization events and UI indicators for connectivity and pending changes.",
    "Progressive Web App support with service worker registration, runtime caching strategies, installation prompts, and offline fallbacks.",
    "Push and contextual notifications for important PEI lifecycle events, approvals, and reminders.",
    "Robust security with row level security policies, hashed token authentication, and layered access control functions.",
    "Reusable UI components built on shadcn/ui and Tailwind CSS for consistency and responsiveness."
  ],
  "user_flow_summary": [
    "User authentication and role assignment determine access rights to networks, schools, students, and PEIs.",
    "Teachers create or edit a PEI for a student, triggering automatic version increment and locking of previous versions.",
    "Coordinators review pending PEIs in their dashboard, approve or return with comments, updating status and notifying stakeholders.",
    "Family members receive secure tokens to view approved PEIs via a dedicated portal with token expiration management.",
    "All users operate seamlessly offline with locally cached data, which synchronizes automatically upon reconnection.",
    "Notifications alert users to relevant events such as new PEIs, approvals, comments, and upcoming meetings.",
    "Administrators manage users, schools, and tenants with comprehensive control panels reflecting multi-tenant hierarchies.",
    "System gracefully handles offline mode with UI indicators and manages synchronization conflicts transparently to users.",
    "PWA installation prompt offers users the option to install the app on supported devices for native-like experience."
  ],
  "validation_criteria": [
    "User authentication correctly enforces role-based access to resources according to RLS policies.",
    "PEI creation and versioning logic enforces a single active version per student with proper status transitions.",
    "Family token generation and validation securely controls access with expiry and usage tracking.",
    "Offline caching syncs data accurately without loss or duplication and restores state after connectivity is regained.",
    "Mobile-first responsive UI layouts render correctly across devices and allow full feature use on small screens.",
    "PWA functionality triggers install prompt and supports offline usage with fallback pages and data availability.",
    "Notifications deliver timely and relevant alerts to users with consistent state management.",
    "Dashboards reflect up-to-date information on PEIs, students, and user activities across all roles.",
    "Codebase maintains high test coverage for triggers, policies, and frontend hooks related to PEI lifecycle and synchronization.",
    "Security audits confirm no data leakage across tenants or roles and validate secure token and cache data handling."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React 18",
      "Vite",
      "Tailwind CSS",
      "Supabase (PostgreSQL)",
      "shadcn/ui",
      "React Router",
      "React Query",
      "PWA",
      "IndexedDB (Dexie.js)"
    ],
    "features": [
      {
        "name": "authentication",
        "description": "Sistema de autenticação com múltiplos perfis e roles",
        "files": [
          "src/pages/Auth.tsx",
          "src/hooks/useAuth.ts",
          "src/pages/Dashboard.tsx"
        ]
      },
      {
        "name": "pei_creation",
        "description": "Criação e edição de Planos Educacionais Individualizados",
        "files": [
          "src/pages/CreatePEI.tsx",
          "src/components/pei/StudentIdentificationSection.tsx",
          "src/components/pei/DiagnosisSection.tsx",
          "src/components/pei/PlanningSection.tsx",
          "src/components/pei/ReferralsSection.tsx",
          "src/components/pei/ReportView.tsx"
        ]
      },
      {
        "name": "teacher_dashboard",
        "description": "Dashboard do professor com estatísticas, PEIs e alunos",
        "files": [
          "src/components/dashboards/TeacherDashboard.tsx"
        ]
      },
      {
        "name": "coordinator_dashboard",
        "description": "Dashboard do coordenador com gestão de PEIs e aprovações",
        "files": [
          "src/components/dashboards/CoordinatorDashboard.tsx",
          "src/components/coordinator/PEIQueueTable.tsx",
          "src/components/coordinator/RequestPEIDialog.tsx"
        ]
      },
      {
        "name": "family_access",
        "description": "Acesso da família via tokens seguros para visualizar PEIs",
        "files": [
          "src/pages/FamilyAccess.tsx",
          "src/pages/FamilyPEIView.tsx",
          "src/pages/SecureFamilyAccess.tsx",
          "src/components/coordinator/GenerateFamilyTokenDialog.tsx"
        ]
      },
      {
        "name": "student_management",
        "description": "Gerenciamento de alunos com CRUD completo",
        "files": [
          "src/pages/Students.tsx",
          "src/components/superadmin/CreateStudentDialog.tsx",
          "src/components/superadmin/EditStudentDialog.tsx",
          "src/components/superadmin/StudentsTable.tsx"
        ]
      },
      {
        "name": "offline_sync",
        "description": "Sistema offline-first com sincronização automática",
        "files": [
          "src/hooks/useOfflineSync.ts",
          "src/hooks/useOfflineQuery.ts",
          "src/lib/offlineDatabase.ts",
          "src/lib/offlineStorage.ts",
          "src/services/SyncService.ts",
          "src/components/shared/OfflineIndicator.tsx",
          "src/components/shared/PendingChangesIndicator.tsx"
        ]
      },
      {
        "name": "notifications",
        "description": "Sistema de notificações push e contextuais",
        "files": [
          "src/pages/Notifications.tsx",
          "src/components/shared/NotificationBell.tsx",
          "src/components/shared/NotificationManager.tsx",
          "src/lib/notifications.ts"
        ]
      },
      {
        "name": "reports",
        "description": "Relatórios e visualizações de dados",
        "files": [
          "src/pages/Reports.tsx",
          "src/components/pei/ReportView.tsx"
        ]
      },
      {
        "name": "pei_versioning",
        "description": "Versionamento e histórico de versões de PEIs",
        "files": [
          "src/components/pei/PEIHistoryDialog.tsx",
          "src/components/pei/PEIVersionHistory.tsx",
          "src/components/pei/PEIVersionCompare.tsx",
          "src/hooks/usePEIVersioning.ts"
        ]
      },
      {
        "name": "multi_tenant",
        "description": "Sistema multi-tenant com hierarquia de rede-escola-usuário",
        "files": [
          "src/hooks/useTenant.ts",
          "src/components/shared/InstitutionalLogo.tsx"
        ]
      },
      {
        "name": "pwa_support",
        "description": "Suporte PWA com service worker e instalação",
        "files": [
          "src/components/shared/PWAUpdatePrompt.tsx"
        ]
      },
      {
        "name": "ui_components",
        "description": "Componentes de UI reutilizáveis baseados em shadcn/ui",
        "files": [
          "src/components/ui/"
        ]
      }
    ]
  }
}
